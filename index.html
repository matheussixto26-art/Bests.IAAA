<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Automatizador Sala do Futuro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .loader { border-top-color: #3498db; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-3xl">
        <div class="bg-white rounded-2xl shadow-lg p-6 sm:p-8">
            
            <div class="text-center mb-6">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Automatizador Sala do Futuro</h1>
                <p class="text-gray-500 mt-2">Acesse os dados do aluno de forma unificada.</p>
            </div>

            <!-- Formulário -->
            <div id="login-form" class="space-y-4">
                <div>
                    <label for="ra" class="block text-sm font-medium text-gray-700 mb-1">RA do Aluno (com 'SP' no final)</label>
                    <input type="text" id="ra" value="0001138933600SP" class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Ex: 0001234567890SP">
                </div>
                <div>
                    <label for="senha" class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
                    <input type="password" id="senha" value="Ru20121209@" class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Sua senha">
                </div>
                <button id="submit-btn" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all flex items-center justify-center">
                    <span id="button-text">Buscar Dados</span>
                    <div id="loader" class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 ml-3 hidden"></div>
                </button>
            </div>

            <!-- Área de Mensagens -->
            <div id="message-area" class="mt-6 text-center"></div>

            <!-- Resultados -->
            <div id="results-container" class="mt-8 space-y-6 hidden">
                <!-- Informações do Aluno -->
                <div id="aluno-info" class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-xl font-bold mb-3 border-b pb-2">Informações do Aluno</h2>
                    <div id="aluno-details" class="text-gray-700"></div>
                </div>

                <!-- Lista de Turmas -->
                <div id="turmas-info" class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-xl font-bold mb-3 border-b pb-2">Turmas (SED)</h2>
                    <div id="turmas-list" class="space-y-3"></div>
                </div>

                <!-- Salas Virtuais -->
                <div id="salas-info" class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-xl font-bold mb-3 border-b pb-2">Salas Virtuais (IP.TV)</h2>
                    <div id="salas-list" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
                </div>
            </div>

        </div>
        <footer class="text-center mt-6 text-xs text-gray-400">
            <p>Ferramenta independente sem vínculo com a SED/SP. Use com responsabilidade.</p>
        </footer>
    </div>

    <script>
        document.getElementById('submit-btn').addEventListener('click', async () => {
            const ra = document.getElementById('ra').value.trim();
            const senha = document.getElementById('senha').value.trim();

            if (!ra || !senha) {
                showMessage('Por favor, preencha o RA e a senha.', 'error');
                return;
            }

            setLoading(true);
            clearResults();

            try {
                const response = await fetch('/api/server', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ra, senha })
                });

                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.details || data.error || 'Ocorreu um erro desconhecido.');
                }
                
                showMessage('Dados obtidos com sucesso!', 'success');
                displayResults(data);

            } catch (error) {
                console.error('Erro no processo:', error);
                showMessage(`Erro: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        });

        function displayResults(data) {
            // Aluno
            const alunoDiv = document.getElementById('aluno-details');
            alunoDiv.innerHTML = `
                <p><strong>Nome:</strong> ${data.alunoInfo.nome || 'N/A'}</p>
                <p><strong>Email:</strong> ${data.alunoInfo.email || 'N/A'}</p>
                <p><strong>Código:</strong> ${data.alunoInfo.codigoAluno || 'N/A'}</p>
            `;

            // Turmas
            const turmasDiv = document.getElementById('turmas-list');
            turmasDiv.innerHTML = '';
            if (data.turmas && data.turmas.length > 0) {
                data.turmas.forEach(turma => {
                    const card = document.createElement('div');
                    card.className = 'p-3 bg-white border rounded-md shadow-sm';
                    card.innerHTML = `<p class="font-semibold">${turma.nome || 'N/A'}</p><p class="text-sm text-gray-600">Ano: ${turma.anoLetivo} | Turno: ${turma.turno}</p>`;
                    turmasDiv.appendChild(card);
                });
            } else {
                turmasDiv.innerHTML = '<p class="text-gray-500">Nenhuma turma encontrada.</p>';
            }

            // Salas Virtuais
            const salasDiv = document.getElementById('salas-list');
            salasDiv.innerHTML = '';
            if (data.salasVirtuais && data.salasVirtuais.length > 0) {
                data.salasVirtuais.forEach(sala => {
                    const card = document.createElement('div');
                    card.className = 'p-3 bg-white border rounded-md shadow-sm flex items-center space-x-3';
                    card.innerHTML = `
                        <img src="${sala.card?.thumbnail || 'https://placehold.co/100x60/e2e8f0/a0aec0?text=Sala'}" class="w-24 h-16 object-cover rounded-md bg-gray-200" alt="Thumbnail da sala">
                        <div>
                            <p class="font-semibold">${sala.name || 'N/A'}</p>
                            <p class="text-xs text-gray-500">${sala.description || 'Sem descrição'}</p>
                        </div>
                    `;
                    salasDiv.appendChild(card);
                });
            } else {
                salasDiv.innerHTML = '<p class="text-gray-500">Nenhuma sala virtual encontrada.</p>';
            }

            document.getElementById('results-container').classList.remove('hidden');
        }
        
        // Funções de UI
        const messageArea = document.getElementById('message-area');
        function setLoading(isLoading) {
            document.getElementById('submit-btn').disabled = isLoading;
            document.getElementById('loader').classList.toggle('hidden', !isLoading);
            document.getElementById('button-text').textContent = isLoading ? 'Processando...' : 'Buscar Dados';
        }
        function showMessage(msg, type = 'info') {
            const colors = { success: 'bg-green-100 text-green-800', error: 'bg-red-100 text-red-800', info: 'bg-blue-100 text-blue-800' };
            messageArea.innerHTML = `<div class="p-3 rounded-lg ${colors[type]}">${msg}</div>`;
        }
        function clearResults() {
            messageArea.innerHTML = '';
            document.getElementById('results-container').classList.add('hidden');
        }
    </script>
</body>
                    </html>
                    
